<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Differential networks • NetCoMi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Differential networks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NetCoMi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/NetCoMi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/net_comparison.html">Network comparison</a></li>
    <li><a class="dropdown-item" href="../articles/diffnet.html">Differential networks</a></li>
    <li><a class="dropdown-item" href="../articles/dissimilarity_networks.html">Dissimilarity-based Networks</a></li>
    <li><a class="dropdown-item" href="../articles/create_asso_perm.html">Generate permuted association matrices</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>More examples</h6></li>
    <li><a class="dropdown-item" href="../articles/plot_modifications.html">Modifying the network plot</a></li>
    <li><a class="dropdown-item" href="../articles/asso_as_input.html">Association matrix as input</a></li>
    <li><a class="dropdown-item" href="../articles/cross_domain_networks.html">Cross-domain networks</a></li>
    <li><a class="dropdown-item" href="../articles/soil_example.html">Soil microbiome example</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stefpeschel/NetCoMi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Differential networks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stefpeschel/NetCoMi/blob/main/vignettes/diffnet.Rmd" class="external-link"><code>vignettes/diffnet.Rmd</code></a></small>
      <div class="d-none name"><code>diffnet.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://netcomi.de">NetCoMi</a></span><span class="op">)</span></span></code></pre></div>
<p>A further possibility to compare two networks are so called
<em>differential networks</em>, where two nodes are connected if they
are differentially associated between the two groups.</p>
<p>We start by dividing the amgut data set into two groups: samples with
and without seasonal allergies.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"amgut2.filt.phy"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split the phyloseq object into two groups</span></span>
<span><span class="va">amgut_season_yes</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/subset_samples-methods.html" class="external-link">subset_samples</a></span><span class="op">(</span><span class="va">amgut2.filt.phy</span>, </span>
<span>                                             <span class="va">SEASONAL_ALLERGIES</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span></span>
<span><span class="va">amgut_season_no</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/subset_samples-methods.html" class="external-link">subset_samples</a></span><span class="op">(</span><span class="va">amgut2.filt.phy</span>, </span>
<span>                                            <span class="va">SEASONAL_ALLERGIES</span> <span class="op">==</span> <span class="st">"no"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">amgut_season_yes</span></span>
<span><span class="co">#&gt; phyloseq-class experiment-level object</span></span>
<span><span class="co">#&gt; otu_table()   OTU Table:         [ 138 taxa and 121 samples ]</span></span>
<span><span class="co">#&gt; sample_data() Sample Data:       [ 121 samples by 166 sample variables ]</span></span>
<span><span class="co">#&gt; tax_table()   Taxonomy Table:    [ 138 taxa by 7 taxonomic ranks ]</span></span>
<span><span class="va">amgut_season_no</span></span>
<span><span class="co">#&gt; phyloseq-class experiment-level object</span></span>
<span><span class="co">#&gt; otu_table()   OTU Table:         [ 138 taxa and 163 samples ]</span></span>
<span><span class="co">#&gt; sample_data() Sample Data:       [ 163 samples by 166 sample variables ]</span></span>
<span><span class="co">#&gt; tax_table()   Taxonomy Table:    [ 138 taxa by 7 taxonomic ranks ]</span></span></code></pre></div>
<p>Due to its very short execution time, we use Pearson’s correlations
for estimating associations between OTUs.</p>
<p>Fisher’s z-test is applied for identifying differentially correlated
OTUs. Multiple testing adjustment is done by controlling the local false
discovery rate.</p>
<p>Note: <code>sparsMethod</code> is set to <code>"none"</code>, just to
be able to include all differential associations in the association
network plot (see below). However, the differential network is always
based on the estimated association matrices before sparsification (the
<code>assoEst1</code> and <code>assoEst2</code> matrices returned by
<code><a href="../reference/netConstruct.html">netConstruct()</a></code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net_season_pears</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netConstruct.html">netConstruct</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">amgut_season_no</span>, </span>
<span>                                 data2 <span class="op">=</span> <span class="va">amgut_season_yes</span>, </span>
<span>                                 filtTax <span class="op">=</span> <span class="st">"highestVar"</span>,</span>
<span>                                 filtTaxPar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>highestVar <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>                                 measure <span class="op">=</span> <span class="st">"pearson"</span>, </span>
<span>                                 normMethod <span class="op">=</span> <span class="st">"clr"</span>,</span>
<span>                                 sparsMethod <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>                                 thresh <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                 verbose <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Checking input arguments ... Done.</span></span>
<span><span class="co">#&gt; Infos about changed arguments:</span></span>
<span><span class="co">#&gt; Zero replacement needed for clr transformation. "multRepl" used.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data filtering ...</span></span>
<span><span class="co">#&gt; 95 taxa removed in each data set.</span></span>
<span><span class="co">#&gt; 1 rows with zero sum removed in group 1.</span></span>
<span><span class="co">#&gt; 1 rows with zero sum removed in group 2.</span></span>
<span><span class="co">#&gt; 43 taxa and 162 samples remaining in group 1.</span></span>
<span><span class="co">#&gt; 43 taxa and 120 samples remaining in group 2.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Zero treatment in group 1:</span></span>
<span><span class="co">#&gt; Execute multRepl() ... Done.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Zero treatment in group 2:</span></span>
<span><span class="co">#&gt; Execute multRepl() ... Done.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Normalization in group 1:</span></span>
<span><span class="co">#&gt; Execute clr(){SpiecEasi} ... Done.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Normalization in group 2:</span></span>
<span><span class="co">#&gt; Execute clr(){SpiecEasi} ... Done.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calculate 'pearson' associations ... Done.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calculate associations in group 2 ... Done.</span></span>
<span></span>
<span><span class="co"># Differential network construction</span></span>
<span><span class="va">diff_season</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diffnet.html">diffnet</a></span><span class="op">(</span><span class="va">net_season_pears</span>,</span>
<span>                       diffMethod <span class="op">=</span> <span class="st">"fisherTest"</span>, </span>
<span>                       adjust <span class="op">=</span> <span class="st">"lfdr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Checking input arguments ... </span></span>
<span><span class="co">#&gt; Done.</span></span>
<span><span class="co">#&gt; Adjust for multiple testing using 'lfdr' ... </span></span>
<span><span class="co">#&gt; Execute fdrtool() ...</span></span>
<span><span class="co">#&gt; Step 1... determine cutoff point</span></span>
<span><span class="co">#&gt; Step 2... estimate parameters of null distribution and eta0</span></span>
<span><span class="co">#&gt; Step 3... compute p-values and estimate empirical PDF/CDF</span></span>
<span><span class="co">#&gt; Step 4... compute q-values and local fdr</span></span>
<span><span class="co">#&gt; Done.</span></span>
<span></span>
<span><span class="co"># Differential network plot</span></span>
<span><span class="fu"><a href="../reference/plot.microNetProps.html">plot</a></span><span class="op">(</span><span class="va">diff_season</span>, </span>
<span>     cexNodes <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>     cexLegend <span class="op">=</span> <span class="fl">3</span>,</span>
<span>     cexTitle <span class="op">=</span> <span class="fl">4</span>,</span>
<span>     mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">8</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>     legendGroupnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group 'no'"</span>, <span class="st">"group 'yes'"</span><span class="op">)</span>,</span>
<span>     legendPos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>,<span class="fl">1.6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="diffnet_files/figure-html/diffnet_1-1.png" width="9000"></p>
<p>In the differential network shown above, edge colors represent the
direction of associations in the two groups. If, for instance, two OTUs
are positively associated in group 1 and negatively associated in group
2 (such as ‘191541’ and ‘188236’), the respective edge is colored in
cyan.</p>
<p>We also take a look at the corresponding associations by constructing
association networks that include only the differentially associated
OTUs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">props_season_pears</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netAnalyze.html">netAnalyze</a></span><span class="op">(</span><span class="va">net_season_pears</span>, </span>
<span>                                 clustMethod <span class="op">=</span> <span class="st">"cluster_fast_greedy"</span>,</span>
<span>                                 weightDeg <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 normDeg <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 gcmHeat <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identify the differentially associated OTUs</span></span>
<span><span class="va">diffmat_sums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">diff_season</span><span class="op">$</span><span class="va">diffAdjustMat</span><span class="op">)</span></span>
<span><span class="va">diff_asso_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">diffmat_sums</span><span class="op">[</span><span class="va">diffmat_sums</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.microNetProps.html">plot</a></span><span class="op">(</span><span class="va">props_season_pears</span>, </span>
<span>     nodeFilter <span class="op">=</span> <span class="st">"names"</span>,</span>
<span>     nodeFilterPar <span class="op">=</span> <span class="va">diff_asso_names</span>,</span>
<span>     nodeColor <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>     highlightHubs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     sameLayout <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>     layoutGroup <span class="op">=</span> <span class="st">"union"</span>,</span>
<span>     rmSingles <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>     nodeSize <span class="op">=</span> <span class="st">"clr"</span>,</span>
<span>     edgeTranspHigh <span class="op">=</span> <span class="fl">20</span>,</span>
<span>     labelScale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     cexNodes <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span>     cexLabels <span class="op">=</span> <span class="fl">3</span>,</span>
<span>     cexTitle <span class="op">=</span> <span class="fl">3.8</span>,</span>
<span>     groupNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No seasonal allergies"</span>, <span class="st">"Seasonal allergies"</span><span class="op">)</span>,</span>
<span>     hubBorderCol  <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.15</span>,<span class="op">-</span><span class="fl">0.7</span>, title <span class="op">=</span> <span class="st">"estimated correlation:"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span>,<span class="st">"-"</span><span class="op">)</span>, </span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#009900"</span>,<span class="st">"red"</span><span class="op">)</span>, inset <span class="op">=</span> <span class="fl">0.05</span>, cex <span class="op">=</span> <span class="fl">4</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">4</span>, </span>
<span>       bty <span class="op">=</span> <span class="st">"n"</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="diffnet_files/figure-html/diffnet_3-1.png" width="12000"></p>
<p>We can see that the correlation between the aforementioned OTUs
‘191541’ and ‘188236’ is strongly positive in the left group and
negative in the right group.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://stefpeschel.de/" class="external-link">Stefanie Peschel</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
